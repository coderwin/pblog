## React Native（RN）调研报告

### 一、RN的优点缺点

#### 优点

* 1、调试方便

>和Native交互的调试 只要代码有变化在Xcode的模拟器自动同步，通过command+R刷新即可看到效果，相对于Native的Run一次编译就需要很长时间来说更方便

* 2、体验媲美Native

>用Web很难达到和原生Native一样的体验，而用RN可以很简单的实现媲美原生的交互

* 3、开发效率高

>（[官方](http://facebook.github.io/react-native/)说法: learn once, write anywhere），RN基于React，采用标签化组件的方式编写，以CSS的方式布局，对于FE来说比较熟悉，学习成本不高，开发效率高。更重要的是和Web一样安卓和IOS一套代码

* 4、代码热部署

>版本迭代方便，不需要等待Appstore的审核发布，而是和Web一样，更新服务端的静态资源即可实现版本迭代

* 5、维护成本低

>和Hybird一样具有跨平台性，在IOS和安卓两端共用一套RN代码(需要一些兼容处理)，淘宝FE还开源了[React-web](https://github.com/taobaofed/react-web)把RN代码打包成可跑在web的程序

#### 缺点

* 1、文档和组件欠缺

>官方提供的API和一些实用文档不全，有的组件API需要深入源码，官方提供的组件不全，需要我们FE和客户端实现，并且还存在一些IOS-Only/Andr-Only的组件。

* 2、RN版本升级快

>npm 模块的升级速度很快，RN的版本升级速度很快，根据React的版本升级来看，对老版本的向下兼容并不好（和jquery比真实惨不忍睹），可能存在API不能用被迫升级RN的库文件

* 3、全新技术需要踩坑

>业界在RN上的实践基本没有开源，需要我们去实现，比如天猫HD的RN实践打包上线方案，淘宝和腾讯的增量升级方案。遇到问题大多只能通过stack／github找到解决方案。


### 二、RN解决的痛点

#### Native痛点

无法跨平台，不同平台不同API，开发和发布效率不高，重复coding->编译->打包->自测->coding->编译->打包->自测，版本迭代只能通过发包进行

#### Hybird痛点

浏览器复杂度较高，DOM繁重，追求流畅性的代价较高
发布Hybird先有的开发测试上线流程复杂
具体的比较见Xmind

#### RN解决的痛点

* 开发阶段

>相对Native不需要编译打包，直接watch RN代码的变化，就可以动态更新APP上面的代码。

* 测试阶段

>简化RMS的开发测试流程，遇到有和Native交互的地方，不需要－无线FE（Hybird API维护者）＋ Native（IOS／Andr）一起处理，如果是RN的交互，可以由我们自己完成，如果有Native交互，也不需要无线FE的配合。减少了

* 上线阶段

>1、替换升级方案：上线时只上一个打包后的RN代码bundle文件，简化了原有的RMS上线流程（FE在RMS开发环境下开发－>RMS测试环境下测试－>找无线FE上线）。

>2、如果是增量升级方案：还可以充分利用缓存，只下载变化的部分（谷歌开源了一个Diff算法）

### 三、RN的使用场景

* 全新的APP开发
* 现有APP中集成

### 四、RN在业界的实践

#### 非全量应用RN

* 天猫HD部分页面
* 网易有钱部分页面
* 饿了么APP部分页面
* 美团APP部分页面

#### 全量应用RN

facebook官方的几个APP，以及在RN官方网站展示的一系列APP

### 五、RN的性能分析

* 内存分析
* CPU占有情况
* 动画效果
* 安装包体积
* listView和scroll的性能

### 六、H5-RN-Native的对比分析

[H5-RN-Native的对比分析](http://blog.csdn.net/yczz/article/details/50468181)

##### OSC 北京源创会分享豆瓣APP的对比分析：

##### 内存分析

* Native：（原生应用启动后，占用内存是20~25M，峰值是87.9M，均值是72M；内存释放比较及时）
![Native](http://static.oschina.net/uploads/img/201601/05233408_wiJf.png)
* Hybird：（App已启动，占用内存35~55M;峰值在137.9M，因为整个应用在WebView中，内存释放不明显，存在缓存）
![Hybird](http://static.oschina.net/uploads/img/201601/05233410_bQvt.png)
* RN：（App启动占用内存35～60M，峰值在142M，内存相对释放明显）
![RN](http://static.oschina.net/uploads/img/201601/05233413_gEe7.png)

#### CPU占用

* Native CPU占用情况，最高值在41%。
* Hybird App的最高值在30%。
* React Native的最高值在34%。

#### 安装包体积

由于RN有RN的库文件，所以RN的安装包体积明显大于Native和Hybird，但是Hybird还需要加载webview里面的JS／CSS等静态资源，所以Hybird和RN持平

### 七、RN的风险点

#### RN本身的风险点

* RN版本更新快，API还不稳定
* issues 处理不过来，可能会遇到issues里的坑
* 组件缺少，需要和native约定具体调用原生组件的方法

#### 发布业务风险点

* 发布业务是五八信息的入口，贸然应用RN可能会造成发布量的降低
* 由于RN支持的版本限制（>IOS7.0||>andr4.1）存在Hybird和RN的共存，维护工作量可能还不如单一的Hybird
* RN集成到鲜有APP中的开发模式对于我们来说还不是很熟悉，可能会带来项目的进度问题
* RN的一些组件的实现如果要兼顾体验，开发可能会耗费的时间比较长
* IOS和andr端的代码并不是完全的一致，可能会先做IOS端开发，然后在兼容andr，如果开发不熟悉，效率可能还不及Hybird
* 客户端和服务端原来Hybird实现的一些接口，在RN中可能不适用，需要客户端和服务端重新开发。


### 八、需要和客户端共同确认

#### 怎么开发?

>前端开发需要有APP的环境，并不是和现在的Hybird开发一样，直接在浏览器里面模拟开发，而是需要借助Xcode／andr SDK搭建APP开发环境。

>前期FE可能和Native的交流多，需要一起共同开发，而不是Native和FE分开开发。

>FE可以分散开发组件，然后组装，和Native交互

#### 怎么测试?

(测试版本管理服务器)
>对于FE的自测来说，在开发过程中通过Xcode的模拟器模拟开发，chrome开发插件进行断点调试，也可以真机调试，

>在测试环境，前端RN代码打包上传测试服务器，需要一个类似RMS的RN代码版本管理系统(系统简化RMS步骤)。在测试环境下默认每次都向服务器请求最新版本文件，

#### 怎么缓存?

>在测试环境下（RN代码先请求测试版本管理服务器询问是否要更新）测试版本管理服务器返回确定的不从缓存中读取，上线后，做APP本地缓存，如果版本有更新久下载最新的RN代码替换缓存中的代码，

>打开APP，先发请求看是否要升级，如果需要升级，就开始下载，再次打开APP是，读取上次下载的Rn代码，实现升级－－>静默升级方案（微软CodePush的方案）?


#### 怎么上线?

（实时更新的实现方案及缓存方案 工程问题）

FB官方提供两种方式集成RN代码，一种方式是把RN代码打包到一个bundlejs中，通过Http请求拉取，另一种是通过APP本地资源，根据业界的实现来说

RNpack打包RN框架JS预置在客户端
RNpack打包业务JS发布线上CDN，客户端下载业务JS，配合RN的框架JS进行RN应用的初始化。

增量升级?（通过升级包的形式）
替换升级?（通过现有的CDN升级方案）

codepush? 成本小
CDN? 需要自己的一套版本控制系统

### 九、总结

RN现状是拥有Hybird的版本迭代能力，有接近Native的体验，有很多的优点，但是作为58信息入口的发布业务，存在一定的风险，下一步要做的是怎么从开发测试到上线把风险降到最低。

